<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Cell Ranger ARC for preprocessing sequencing data | Hands-on Analysis on Single Cell Multiome</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Cell Ranger ARC for preprocessing sequencing data | Hands-on Analysis on Single Cell Multiome" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Cell Ranger ARC for preprocessing sequencing data | Hands-on Analysis on Single Cell Multiome" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Danni Liu" />


<meta name="date" content="2024-06-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="seuratqc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Hands-on Analysis on Single Cell Multiome</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-data"><i class="fa fa-check"></i><b>1.1</b> About Data</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#server-environment-requirements"><i class="fa fa-check"></i><b>1.2</b> Server environment requirements</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-libraries"><i class="fa fa-check"></i><b>1.3</b> R libraries</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#construct-folder-structure"><i class="fa fa-check"></i><b>1.4</b> Construct folder structure</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#accessing-pancreas-data"><i class="fa fa-check"></i><b>1.5</b> Accessing pancreas data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cellranger_arc.html"><a href="cellranger_arc.html"><i class="fa fa-check"></i><b>2</b> Cell Ranger ARC for preprocessing sequencing data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cellranger_arc.html"><a href="cellranger_arc.html#cellranger-arc-mkfastq"><i class="fa fa-check"></i><b>2.1</b> <code>cellranger-arc mkfastq</code></a></li>
<li class="chapter" data-level="2.2" data-path="cellranger_arc.html"><a href="cellranger_arc.html#bcl-naming-convention"><i class="fa fa-check"></i><b>2.2</b> BCL naming convention</a></li>
<li class="chapter" data-level="2.3" data-path="cellranger_arc.html"><a href="cellranger_arc.html#cellranger-arc-count"><i class="fa fa-check"></i><b>2.3</b> <code>cellranger-arc count</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="seuratqc.html"><a href="seuratqc.html"><i class="fa fa-check"></i><b>3</b> Obtain data and perform QC using Seurat</a>
<ul>
<li class="chapter" data-level="3.1" data-path="seuratqc.html"><a href="seuratqc.html#download-data"><i class="fa fa-check"></i><b>3.1</b> Download data</a></li>
<li class="chapter" data-level="3.2" data-path="seuratqc.html"><a href="seuratqc.html#load-data-in-r-and-construct-seurat-object"><i class="fa fa-check"></i><b>3.2</b> Load data in R and construct Seurat object</a></li>
<li class="chapter" data-level="3.3" data-path="seuratqc.html"><a href="seuratqc.html#perform-quality-control-using-both-assays"><i class="fa fa-check"></i><b>3.3</b> Perform quality control using both assays</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="normalization-and-cell-cycle-correction.html"><a href="normalization-and-cell-cycle-correction.html"><i class="fa fa-check"></i><b>4</b> Normalization and cell cycle correction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="normalization-and-cell-cycle-correction.html"><a href="normalization-and-cell-cycle-correction.html#normalization"><i class="fa fa-check"></i><b>4.1</b> Normalization</a></li>
<li class="chapter" data-level="4.2" data-path="normalization-and-cell-cycle-correction.html"><a href="normalization-and-cell-cycle-correction.html#cell-cycle-correction-and-scale-data"><i class="fa fa-check"></i><b>4.2</b> Cell cycle correction and scale data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dimension-reduction-and-clustering.html"><a href="dimension-reduction-and-clustering.html"><i class="fa fa-check"></i><b>5</b> Dimension reduction and clustering</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dimension-reduction-and-clustering.html"><a href="dimension-reduction-and-clustering.html#identify-top-variable-features"><i class="fa fa-check"></i><b>5.1</b> Identify top variable features</a></li>
<li class="chapter" data-level="5.2" data-path="dimension-reduction-and-clustering.html"><a href="dimension-reduction-and-clustering.html#dimension-reduction"><i class="fa fa-check"></i><b>5.2</b> Dimension reduction</a></li>
<li class="chapter" data-level="5.3" data-path="dimension-reduction-and-clustering.html"><a href="dimension-reduction-and-clustering.html#clustering-and-joint-clustering"><i class="fa fa-check"></i><b>5.3</b> Clustering and joint clustering</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="differential-expression-de-analysis-and-cell-type-annotation.html"><a href="differential-expression-de-analysis-and-cell-type-annotation.html"><i class="fa fa-check"></i><b>6</b> Differential Expression (DE) analysis and cell type annotation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="differential-expression-de-analysis-and-cell-type-annotation.html"><a href="differential-expression-de-analysis-and-cell-type-annotation.html#de-analysis"><i class="fa fa-check"></i><b>6.1</b> DE analysis</a></li>
<li class="chapter" data-level="6.2" data-path="differential-expression-de-analysis-and-cell-type-annotation.html"><a href="differential-expression-de-analysis-and-cell-type-annotation.html#cell-type-annotation"><i class="fa fa-check"></i><b>6.2</b> Cell type annotation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="peak-calling-and-motif-analysis.html"><a href="peak-calling-and-motif-analysis.html"><i class="fa fa-check"></i><b>7</b> Peak calling and Motif analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="peak-calling-and-motif-analysis.html"><a href="peak-calling-and-motif-analysis.html#linkage-plot"><i class="fa fa-check"></i><b>7.1</b> Linkage plot</a></li>
<li class="chapter" data-level="7.2" data-path="peak-calling-and-motif-analysis.html"><a href="peak-calling-and-motif-analysis.html#call-peaks-using-macs2"><i class="fa fa-check"></i><b>7.2</b> Call peaks using MACS2</a></li>
<li class="chapter" data-level="7.3" data-path="peak-calling-and-motif-analysis.html"><a href="peak-calling-and-motif-analysis.html#motif-analysis"><i class="fa fa-check"></i><b>7.3</b> Motif analysis</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-integration.html"><a href="data-integration.html"><i class="fa fa-check"></i><b>8</b> Data integration</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-integration.html"><a href="data-integration.html#identifying-anchors-between-scrna-seq-and-scatac-seq-datasets"><i class="fa fa-check"></i><b>8.1</b> Identifying anchors between scRNA-seq and scATAC-seq datasets</a></li>
<li class="chapter" data-level="8.2" data-path="data-integration.html"><a href="data-integration.html#annotate-scatac-seq-cells-via-label-transfer"><i class="fa fa-check"></i><b>8.2</b> Annotate scATAC-seq cells via label transfer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hands-on Analysis on Single Cell Multiome</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cellranger_arc" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Cell Ranger ARC for preprocessing sequencing data<a href="cellranger_arc.html#cellranger_arc" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Cell Ranger ARC is a set of analysis pipelines that process Chromium Single Cell Multiome ATAC + Gene Expression sequencing data to generate a variety of analyses pertaining to gene expression (GEX), chromatin accessibility, and their linkage. The pipeline includes base calling, sample demultiplexing, mapping, peak calling and read counting. You can refer to the complete instructions from 10x Genomics <a href="https://www.10xgenomics.com/support/software/cell-ranger-arc/latest/analysis/running-pipelines/single-library-analysis">here</a>.</p>
<blockquote>
<p>Note that the Cell Ranger ARC pipeline can only analyze Gene Expression and ATAC data together. It must not be used to analyze Gene Expression or ATAC alone. If scRNA-seq and scATAC-seq are generated from separate experiments, you should process them separately– using <a href="https://www.10xgenomics.com/support/software/cell-ranger/latest">Cell Ranger</a> for processing scRNA-seq and <a href="https://support.10xgenomics.com/single-cell-atac/software/overview/welcome">Cell Ranger ATAC</a> for processing scATAC-seq.</p>
</blockquote>
<p>The analysis involves the following steps:</p>
<ul>
<li>Step 1: Generate FASTQ files and perform demultiplexing by running <code>cellranger-arc mkfastq</code> on the Illumina <code>BCL</code>(base call files) output folder for each ATAC (GEX resp.) flow cell to generate ATAC (GEX resp.) FASTQ data. Note that a separate run of <code>mkfastq</code> is required for each ATAC and each GEX flow cell.<br />
</li>
<li>Step 2: Run a separate instance of <code>cellranger-arc count</code> for each GEM well that was demultiplexed by the <code>cellranger-arc mkfastq</code> in the previous step.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="images/gex-atac.png" alt="The new SSA logo, which is actually a scatterplot, which is super neat!" width="100%" />
<p class="caption">
Figure 2.1: The new SSA logo, which is actually a scatterplot, which is super neat!
</p>
</div>
<p>The FASTQ files are usually prepared by our sequencing core, so we can take the FASTQ files as input and call <code>callranger-arc count</code> to generate count matrices directly.</p>
<div id="note" style="color: red;">
<p>Note: We won’t run <code>cellranger-arc</code> in this hands-on session, so the sections below just show some example codes for running the pipeline. You can check the Cell Ranger website for detailed instructions for preparing input files for each step.</p>
</div>
<div id="note" style="color: red;">
<p><code>cellranger-arc</code> is already installed in HPC3 environment under specific containers, so we can call it directly using <code>module load</code>. You can check available software in HPC3 using <code>module avail</code>.</p>
</div>
<div id="cellranger-arc-mkfastq" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> <code>cellranger-arc mkfastq</code><a href="cellranger_arc.html#cellranger-arc-mkfastq" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Cell Ranger ARC pipeline starts with Illumina sequencer’s base call files (BCLs), and converts them into FASTQ files using <code>cellranger-arc mkfastq</code>. The <code>cellranger-arc mkfastq</code> is a pipeline that wraps Illumina’s <em>bcl2fastq</em>, while also supports demultiplexing of ATAC or Gene Expression (GEX) flow cells. For the demultiplexing purpose, the <code>cellranger-arc mkfastq</code> should be run for each flow cell separately, independent of the number of sequencing runs of each library. Below are two examples.</p>
<p>In the first example, a library with sample index SI-NA-A1 was sequenced on two flow cells. The <code>cellranger-arc mkfastq</code> should be carried out for each flow cell. Next, the outputs will be processed though a single instance of <code>cellranger-arc count</code>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="images/ATAC-1.png" alt="The new SSA logo, which is actually a scatterplot, which is super neat!" width="100%" />
<p class="caption">
Figure 2.2: The new SSA logo, which is actually a scatterplot, which is super neat!
</p>
</div>
<p>In the second example, two libraries (each processed through a separate GEM well with sample indices SI-TT-A1 and SI-TT-A2) are multiplexed on a single flow cell in one sequencing run. GEX Library 1 was processed on lane 1 and GEX Library 2 was processed on lane 2 of the same flow cell. A single <code>cellranger-arc mkfastq</code> should be carried out for this flow cell.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-3"></span>
<img src="images/GEX-multiplex.png" alt="The new SSA logo, which is actually a scatterplot, which is super neat!" width="100%" />
<p class="caption">
Figure 2.3: The new SSA logo, which is actually a scatterplot, which is super neat!
</p>
</div>
<p>For running <code>cellranger-arc mkfastq</code>, you will input a folder with BCL outputs from 10X machine, and a CSV sample sheet.</p>
<p>An example of the sample sheet is shown below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="cellranger_arc.html#cb1-1" tabindex="-1"></a><span class="ex">$</span> cat cellranger-arc-test-bcl-atac-simple-1.0.0.csv</span>
<span id="cb1-2"><a href="cellranger_arc.html#cb1-2" tabindex="-1"></a><span class="ex">Lane,Sample,Index</span></span>
<span id="cb1-3"><a href="cellranger_arc.html#cb1-3" tabindex="-1"></a><span class="ex">1,test_sample_atac,SI-NA-A1</span></span>
<span id="cb1-4"><a href="cellranger_arc.html#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="cellranger_arc.html#cb1-5" tabindex="-1"></a><span class="ex">$</span> cat cellranger-arc-test-bcl-gex-simple-1.0.0.csv</span>
<span id="cb1-6"><a href="cellranger_arc.html#cb1-6" tabindex="-1"></a><span class="ex">Lane,Sample,Index</span></span>
<span id="cb1-7"><a href="cellranger_arc.html#cb1-7" tabindex="-1"></a><span class="ex">1,test_sample_gex,SI-TT-A1</span></span></code></pre></div>
<p>The three columns are:</p>
<ul>
<li>Lane: Which lane(s) of the flow cell to process. Can be either a single lane, a range (e.g., 2-4) or ’*’ for all lanes in the flow cell.</li>
<li>Sample: The name of the sample that you define.</li>
<li>Index: 10x Genomics sample index that was used in library construction</li>
</ul>
<hr />
<p>Below is an example for running <code>cellranger-arc mkfastq</code> on one atac flow cell. You can specify the path to the BCL file and the CSV sample sheet in <code>--run</code> and <code>--csv</code> respectively.</p>
<pre class="text"><code>$ module load cellranger-arc
$ cellranger-arc mkfastq --id=test_bcl-atac \
                     --run=cellranger-arc-test-bcl-atac-1.0.0 \
                     --csv=cellranger-arc-test-bcl-atac-simple-1.0.0.csv

cellranger-arc mkfastq (2.0.2)
Copyright (c) 2020 10x Genomics, Inc.  All rights reserved.
-------------------------------------------------------------------------------


Martian Runtime - v4.0.5
Running preflight checks (please wait)...
yyyy-mm-dd hh:mm:ss [runtime] (ready)           ID.bcl-atac.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET
yyyy-mm-dd hh:mm:ss [runtime] (split_complete)  ID.bcl-atac.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET
yyyy-mm-dd hh:mm:ss [runtime] (run:local)       ID.bcl-atac.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET.fork0.chnk0.main
yyyy-mm-dd hh:mm:ss [runtime] (chunks_complete) ID.bcl-atac.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET
...
</code></pre>
<p>Once the <code>mkfastq</code> run is completed, you can find the output files in <code>outs/fastq_path</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="cellranger_arc.html#cb3-1" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> test-bcl-atac/outs/fastq_path/</span>
<span id="cb3-2"><a href="cellranger_arc.html#cb3-2" tabindex="-1"></a><span class="ex">total</span> 31744</span>
<span id="cb3-3"><a href="cellranger_arc.html#cb3-3" tabindex="-1"></a><span class="ex">drwxrwxr-x</span> 3 jdoe jdoe       24 Sep  7 22:49 p1</span>
<span id="cb3-4"><a href="cellranger_arc.html#cb3-4" tabindex="-1"></a><span class="ex">drwxrwxr-x</span> 3 jdoe jdoe       26 Sep  7 22:48 Reports</span>
<span id="cb3-5"><a href="cellranger_arc.html#cb3-5" tabindex="-1"></a><span class="ex">drwxrwxr-x</span> 2 jdoe jdoe      193 Sep  7 22:48 Stats</span>
<span id="cb3-6"><a href="cellranger_arc.html#cb3-6" tabindex="-1"></a><span class="ex">-rw-rw-r--</span> 1 jdoe jdoe  3806257 Sep  7 22:48 Undetermined_S0_L001_I1_001.fastq.gz</span>
<span id="cb3-7"><a href="cellranger_arc.html#cb3-7" tabindex="-1"></a><span class="ex">-rw-rw-r--</span> 1 jdoe jdoe   967448 Sep  7 22:48 Undetermined_S0_L001_R1_001.fastq.gz</span>
<span id="cb3-8"><a href="cellranger_arc.html#cb3-8" tabindex="-1"></a><span class="ex">-rw-rw-r--</span> 1 jdoe jdoe  5773976 Sep  7 22:48 Undetermined_S0_L001_R2_001.fastq.gz</span>
<span id="cb3-9"><a href="cellranger_arc.html#cb3-9" tabindex="-1"></a><span class="ex">-rw-rw-r--</span> 1 jdoe jdoe 12635207 Sep  7 22:48 Undetermined_S0_L001_R3_001.fastq.gz</span>
<span id="cb3-10"><a href="cellranger_arc.html#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="cellranger_arc.html#cb3-11" tabindex="-1"></a><span class="ex">$</span> tree test-bcl-atac/outs/fastq_path/test-bcl-atac/</span>
<span id="cb3-12"><a href="cellranger_arc.html#cb3-12" tabindex="-1"></a><span class="ex">test-bcl-atac/outs/fastq_path/p1</span></span>
<span id="cb3-13"><a href="cellranger_arc.html#cb3-13" tabindex="-1"></a><span class="ex">└──</span> s1</span>
<span id="cb3-14"><a href="cellranger_arc.html#cb3-14" tabindex="-1"></a>    <span class="ex">├──</span> test_sample_miseq_S1_L001_I1_001.fastq.gz</span>
<span id="cb3-15"><a href="cellranger_arc.html#cb3-15" tabindex="-1"></a>    <span class="ex">├──</span> test_sample_miseq_S1_L001_R1_001.fastq.gz</span>
<span id="cb3-16"><a href="cellranger_arc.html#cb3-16" tabindex="-1"></a>    <span class="ex">├──</span> test_sample_miseq_S1_L001_R2_001.fastq.gz</span>
<span id="cb3-17"><a href="cellranger_arc.html#cb3-17" tabindex="-1"></a>    <span class="ex">└──</span> test_sample_miseq_S1_L001_R3_001.fastq.gz</span></code></pre></div>
<hr />
</div>
<div id="bcl-naming-convention" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> BCL naming convention<a href="cellranger_arc.html#bcl-naming-convention" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you obtain the FASTQ files from other sources, it is important to ensure that the FASTQ files are named in concordance with the BCL naming convention before running <code>cellranger-arc</code>. (Please refer to the <a href="https://www.10xgenomics.com/support/software/cell-ranger-arc/latest/analysis/specifying-input-fastq-count">cellranger-arc input FASTQ files</a> and <a href="https://support.illumina.com/content/dam/illumina-support/documents/documentation/software_documentation/bcl2fastq/bcl2fastq2-v2-20-software-guide-15051736-03.pdf">bcl2fastq User Guide</a> for complete instructions.)</p>
<p>An example of the FASTQ file looks like this: <code>Sample_S1_L001_R1_001.fastq.gz</code>. Briefly, FASTQ files taken by are named with the sample name and number, the flow cell lane, and read. The file extension is ’*.fastq.gz’.</p>
<p>If the downloaded *.fastq.gz files are not in this naming convention, you will need to manually rename all files before you can call <code>cellranger-arc count</code>.</p>
<p>Here is the explanation for each element in the name:</p>
<ul>
<li>samplename: The name of the sample provided in the sample sheet. If a sample name is not available, the file name uses the sample ID instead.</li>
<li>S1: The number of the sample based on the order that samples are listed in the sample sheet, starting with 1.</li>
<li>L001: The lane number of the flow cell, starting with lane 1, to the number of lanes supported.</li>
<li>R1: The read index. R1 indicates Read 1. R2 indicates Read 2 of a paired-end run.</li>
<li>001: The last portion of the file name is always 001.</li>
<li>Special Note: L001 and L002 are indices of different Illumina sequencing lanes or batches, and we can use these indices as well as sample indices as means by which to distinguish treatment groups. If we want to analyze all samples in one treatment group together, they will be assigned the same sample number (e.g. S1) and different lane number (e.g. L001 and L002). (NOTE: Reads cannot be assigned as sample number 0 or lane number 0. If it has number 0, it will be excluded from downstream analysis.) For example, if there are 2 treatment groups each has 3 replicates, we will index all three replicates in group 1 as S1_L001, S1_L002, S1_L003 and replicates in group 2 as S2_L001, S2_L002 and S3_L003.</li>
</ul>
<hr />
</div>
<div id="cellranger-arc-count" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> <code>cellranger-arc count</code><a href="cellranger_arc.html#cellranger-arc-count" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For paired GEX and ATAC sequnecing, we will organize the FASTQ files from the same sample on a library CSV file and pass it to <code>cellranger-arc count</code>.</p>
<p>An example of the library CSV looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="cellranger_arc.html#cb4-1" tabindex="-1"></a><span class="ex">fastqs,sample,library_type</span></span>
<span id="cb4-2"><a href="cellranger_arc.html#cb4-2" tabindex="-1"></a><span class="ex">/home/jdoe/fastq_path,example,Gene</span> Expression</span>
<span id="cb4-3"><a href="cellranger_arc.html#cb4-3" tabindex="-1"></a><span class="ex">/home/jdoe/fastq_path,example,Chromatin</span> Accessibility</span></code></pre></div>
<p>The three columns are:</p>
<ul>
<li>fastqs: A path to the directory containing the demultiplexed FASTQ files for this sample. If you have multiple sets of fastqs for this library, add an additional row, and use the use same library_type value.</li>
<li>sample: Sample name assigned as the Sample_ID in the demultiplexing sample sheet.</li>
<li>library_type: This field is case-sensitive and must <strong>exactly match</strong> “Chromatin Accessibility” for a Multiome ATAC library and “Gene Expression” for a Multiome GEX library.</li>
</ul>
<p>You will also need to download a reference annotation for alignment. 10x Genomics provides references for Human and Mouse in their <a href="https://www.10xgenomics.com/support/software/cell-ranger/downloads#reference-downloads">Download Center</a>. But you can also build your own reference using <code>cellranger-arc mkref</code> if you have the FASTA or GTF of your reference package. Complete instructions for doing this can be found from their <a href="https://www.10xgenomics.com/support/software/cell-ranger-arc/latest/analysis/mkref">manual</a></p>
<hr />
<p>Once all input files are prepared, we are ready to run <code>cellranger-arc count</code>. An example code for running one sample looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="cellranger_arc.html#cb5-1" tabindex="-1"></a><span class="ex">$</span> cd /dfs6/pub/your_username</span>
<span id="cb5-2"><a href="cellranger_arc.html#cb5-2" tabindex="-1"></a><span class="ex">$</span> cellranger-arc count <span class="at">--id</span><span class="op">=</span>Pancreas1 <span class="dt">\</span></span>
<span id="cb5-3"><a href="cellranger_arc.html#cb5-3" tabindex="-1"></a>                       <span class="at">--reference</span><span class="op">=</span>/home/jovyan/commondata/cellranger-arc/refdata-cellranger-arc-mm10-2020-A-2.0.0 <span class="dt">\</span></span>
<span id="cb5-4"><a href="cellranger_arc.html#cb5-4" tabindex="-1"></a>                       <span class="at">--libraries</span><span class="op">=</span>/dfs6/pub/dannil15/cellranger-arc/library.csv <span class="dt">\</span></span>
<span id="cb5-5"><a href="cellranger_arc.html#cb5-5" tabindex="-1"></a>                       <span class="at">--localcores</span><span class="op">=</span>8 <span class="dt">\</span></span>
<span id="cb5-6"><a href="cellranger_arc.html#cb5-6" tabindex="-1"></a>                       <span class="at">--localmem</span><span class="op">=</span>48</span>
<span id="cb5-7"><a href="cellranger_arc.html#cb5-7" tabindex="-1"></a><span class="co"># takes about 6 hours for running one sample</span></span></code></pre></div>
<p>The output folder structure looks like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="cellranger_arc.html#cb6-1" tabindex="-1"></a><span class="ex">Outputs:</span></span>
<span id="cb6-2"><a href="cellranger_arc.html#cb6-2" tabindex="-1"></a>      <span class="ex">...</span></span>
<span id="cb6-3"><a href="cellranger_arc.html#cb6-3" tabindex="-1"></a><span class="ex">-</span> Run summary HTML:                              /home/jdoe/runs/sample345/outs/web_summary.html</span>
<span id="cb6-4"><a href="cellranger_arc.html#cb6-4" tabindex="-1"></a><span class="ex">-</span> Run summary metrics CSV:                       /home/jdoe/runs/sample345/outs/summary.csv</span>
<span id="cb6-5"><a href="cellranger_arc.html#cb6-5" tabindex="-1"></a><span class="ex">-</span> Per barcode summary metrics:                   /home/jdoe/runs/sample345/outs/per_barcode_metrics.csv</span>
<span id="cb6-6"><a href="cellranger_arc.html#cb6-6" tabindex="-1"></a><span class="ex">-</span> Filtered feature barcode matrix MEX:           /home/jdoe/runs/sample345/outs/filtered_feature_bc_matrix</span>
<span id="cb6-7"><a href="cellranger_arc.html#cb6-7" tabindex="-1"></a><span class="ex">-</span> Filtered feature barcode matrix HDF5:          /home/jdoe/runs/sample345/outs/filtered_feature_bc_matrix.h5</span>
<span id="cb6-8"><a href="cellranger_arc.html#cb6-8" tabindex="-1"></a><span class="ex">-</span> Raw feature barcode matrix MEX:                /home/jdoe/runs/sample345/outs/raw_feature_bc_matrix</span>
<span id="cb6-9"><a href="cellranger_arc.html#cb6-9" tabindex="-1"></a><span class="ex">-</span> Raw feature barcode matrix HDF5:               /home/jdoe/runs/sample345/outs/raw_feature_bc_matrix.h5</span>
<span id="cb6-10"><a href="cellranger_arc.html#cb6-10" tabindex="-1"></a><span class="ex">-</span> Loupe browser visualization file:              /home/jdoe/runs/sample345/outs/cloupe.cloupe</span>
<span id="cb6-11"><a href="cellranger_arc.html#cb6-11" tabindex="-1"></a><span class="ex">-</span> GEX Position-sorted alignments BAM:            /home/jdoe/runs/sample345/outs/gex_possorted_bam.bam</span>
<span id="cb6-12"><a href="cellranger_arc.html#cb6-12" tabindex="-1"></a><span class="ex">-</span> GEX Position-sorted alignments BAM index:      /home/jdoe/runs/sample345/outs/gex_possorted_bam.bam.bai</span>
<span id="cb6-13"><a href="cellranger_arc.html#cb6-13" tabindex="-1"></a><span class="ex">-</span> GEX Per molecule information file:             /home/jdoe/runs/sample345/outs/gex_molecule_info.h5</span>
<span id="cb6-14"><a href="cellranger_arc.html#cb6-14" tabindex="-1"></a><span class="ex">-</span> ATAC Position-sorted alignments BAM:           /home/jdoe/runs/sample345/outs/atac_possorted_bam.bam</span>
<span id="cb6-15"><a href="cellranger_arc.html#cb6-15" tabindex="-1"></a><span class="ex">-</span> ATAC Position-sorted alignments BAM index:     /home/jdoe/runs/sample345/outs/atac_possorted_bam.bam.bai</span>
<span id="cb6-16"><a href="cellranger_arc.html#cb6-16" tabindex="-1"></a><span class="ex">-</span> ATAC Per fragment information file:            /home/jdoe/runs/sample345/outs/atac_fragments.tsv.gz</span>
<span id="cb6-17"><a href="cellranger_arc.html#cb6-17" tabindex="-1"></a><span class="ex">-</span> ATAC Per fragment information index:           /home/jdoe/runs/sample345/outs/atac_fragments.tsv.gz.tbi</span>
<span id="cb6-18"><a href="cellranger_arc.html#cb6-18" tabindex="-1"></a><span class="ex">-</span> ATAC peak locations:                           /home/jdoe/runs/sample345/outs/atac_peaks.bed</span>
<span id="cb6-19"><a href="cellranger_arc.html#cb6-19" tabindex="-1"></a><span class="ex">-</span> ATAC smoothed transposition site track:        /home/jdoe/runs/sample345/outs/atac_cut_sites.bigwig</span>
<span id="cb6-20"><a href="cellranger_arc.html#cb6-20" tabindex="-1"></a><span class="ex">-</span> ATAC peak annotations based on proximal genes: /home/jdoe/runs/sample345/outs/atac_peak_annotation.tsv</span>
<span id="cb6-21"><a href="cellranger_arc.html#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="cellranger_arc.html#cb6-22" tabindex="-1"></a><span class="ex">Waiting</span> 6 seconds for UI to do final refresh.</span>
<span id="cb6-23"><a href="cellranger_arc.html#cb6-23" tabindex="-1"></a><span class="ex">Pipestance</span> completed successfully!</span>
<span id="cb6-24"><a href="cellranger_arc.html#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="cellranger_arc.html#cb6-25" tabindex="-1"></a><span class="ex">yyyy-mm-dd</span> hh:mm:ss Shutting down.</span>
<span id="cb6-26"><a href="cellranger_arc.html#cb6-26" tabindex="-1"></a></span>
<span id="cb6-27"><a href="cellranger_arc.html#cb6-27" tabindex="-1"></a><span class="ex">Saving</span> pipestance info to <span class="st">&quot;sample345/sample345.mri.tgz&quot;</span></span></code></pre></div>
<p>The outputs that are useful for next step include:</p>
<ul>
<li><strong>web_summary.html</strong>: Run summary metrics and charts in HTML format.</li>
<li><strong>filtered_feature_bc_matrix.h5</strong>: Filtered feature barcode matrix stored in hdf5 format. The rows consist of all the gene and peak features concatenated together (identical to raw feature barcode matrix) and the columns are restricted to those barcodes that are identified as cells.</li>
<li><strong>filtered_feature_bc_matrix</strong>: Filtered feature barcode matrix stored in MEX format. The rows consist of all the gene and peak features concatenated together (identical to raw feature barcode matrix) and the columns are restricted to those barcodes that are identified as cells.</li>
<li><strong>atac_fragments.tsv.gz</strong>: Count and barcode information for every ATAC fragment observed in the experiment in TSV format.</li>
<li><strong>atac_fragments.tsv.gz.tbi</strong>: Index for atac_fragments.tsv.gz.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="seuratqc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-CellRangerARC.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
